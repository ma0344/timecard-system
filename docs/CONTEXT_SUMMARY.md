# プロジェクト合意サマリ（引き継ぎ用）

- 共通
  - 365日営業。サイドメニューはフォーカストラップ＋初期フォーカス済み。
  - バッジは common.css（info/warn/success/danger/critical）。ハンバーガー背景・hoverあり。
  - 管理者APIは catch 時に error_log へ記録。

- 通知
  - 個別既読あり。未読バッジ即時更新。

- ダッシュボード
  - 打刻アラート
    - 種別トグル: 未退勤=ON, 未打刻=ON, 勤務中=OFF（localStorage保持）。
    - 期間セレクタ: 3/5/7日。上書き（全休/午前/午後/無視）は除外してから集計・表示。
    - 非ちらつき更新: カード単独再描画。深掘りは admin_attendance へディープリンク。
  - 今日の勤務（一覧）
    - 全ユーザー表示（visible=1）。行ボタンで上書き: off_full/off_am/off_pm/ignore/取消。ボタンのactiveで状態を表現。
    - メモ送信可。手動更新＋60秒ポーリング。
    - 実績バッジ表示: 未打刻/勤務中/休憩中/退勤済み（api/today_status_summary.php）。

- 勤怠編集
  - ディープリンクは periodStart/End を考慮して属する月度へ自動切替。
  - 展開パネルにフェード＋左バーのハイライト。

- 上書きデータ（day_status_overrides）
  - 追記型: set は既存有効を revoke→INSERT、clear は revoke のみ。監査性を優先。

- アラート計算
  - attendance_alerts.php は LIMIT 整数直埋め。未打刻は過去日ベース（当日は含めない）で、上書き該当日は除外。
  - バッジ: 未退勤=critical、勤務中=info、未打刻=warn。

- スタイル
  - アラート行は種別に応じた左ボーダー＋淡背景（type-info/warn/critical）。

- 保留/低優先
  - 失効カード: 失効日に失効する時間数の表示。
  - 勤怠表に有給取得行も表示（勤務行とマージ）。
  - 未打刻の真偽判定のサーバ側実装（休日/公休/休暇/上書き除外の厳密化）。
  - 勤怠記録に「休みの明示」統合（表示/集計の更なる反映）。
  - 予定表/シフト導入（将来、未打刻判定の精度向上に活用）。
  - 決裁結果の申請者メール通知は社内ポリシー決定まで保留。