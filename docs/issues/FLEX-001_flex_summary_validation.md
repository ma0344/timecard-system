# [FLEX-001] フレックス清算サマリの検証と QA 整備

ステータス: Open
作成日: 2025-11-29
担当: 未割当
関連: docs/FLEX_SUMMARY.md, myday_dashboard.html, attendance_list.html, api/flex_summary.php

## 背景 / 課題

- `myday_dashboard.html` と `attendance_list.html` にフレックス清算サマリを表示する実装を追加したが、実データでの検証が未完了。
- 清算月の 2 ヶ月合算ロジックや、丸め設定の表示が現場運用に適合しているか確認が必要。
- part-time ユーザーに対してカードが非表示になる設計のため、通知やヘルプ文の追加が求められている。
- 例外時（API 500 など）のユーザー通知が曖昧で、原因把握が難しいケースが想定される。

## 目的

- 常勤ユーザー向けに正しい差分が表示されることを確認し、清算月ロジックを運用に耐える品質へ引き上げる。
- 異常時の挙動とログ出力を整理し、運用チームがトラブルを素早く検知できる状態にする。
- FAQ / ヘルプで活用できるメッセージ（非常勤ユーザーへの案内など）を用意する。

## スコープ

- `api/flex_summary.php` の集計精度検証（単月・2 ヶ月ケース、休暇・休職入り）。
- `myday_dashboard.html` / `attendance_list.html` の UI 表示確認、エラー表示ポリシー策定。
- 丸め設定変更時（例: 四捨五入 / 15 分）における表示テスト。
- part-time ユーザー向けメッセージ案の検討と実装方針合意。

## 非スコープ

- フレックス制度そのものの制度改定。
- 既存の勤怠集計ロジック（残業・休暇）全体の再設計。
- 管理者向けレポート画面の実装。

## 成果物

- テスト観点と期待値を記録した検証レポート（簡易で可）。
- 必要に応じたコード修正（UI メッセージ、フォールバック挙動など）。
- 今後の運用マニュアル / FAQ で流用できる要点メモ。

## タスク（2025-11-29 時点）

- [ ] テストデータ作成: 単月（通常）/ 清算月（2 ヶ月）/ 長期有給ケース。
- [ ] API レスポンス確認: `legal_minutes`, `worked_minutes`, `paid_leave_minutes`, `delta_minutes` の突合。
- [ ] UI 確認: My Day / 勤務記録一覧で差分と詳細欄が期待通りか検証。
- [ ] エラー時シナリオ: DB 接続失敗などでカードがどう表示されるか確認し、必要ならメッセージを追加。
- [ ] part-time ユーザーへの案内文（例: カード非表示時にヘルプリンク）を検討。
- [ ] 成果を docs/FLEX_SUMMARY.md に反映し、受け入れ基準を更新。

## 期日目安

- QA 実施: 2025-12-05 まで
- フィードバック反映: 2025-12-09 まで

## リスク / 留意点

- 休日の所定時間設定が不足していると差分が大きくブレる可能性がある。
- `paid_leave_use_events` が 0.25h 単位などの場合、丸め設定の影響が顕著に出るため、分単位での表示妥当性を確認する必要がある。
- API 例外時に My Day 側がカードを非表示にするため、ユーザーが異常に気付きにくい。ログ出力や通知の強化が望ましい。
